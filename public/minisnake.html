<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üî• Mini Snake ‚Äî Impossible Speed Mode</title>
<style>
  :root{
    --bg1:#0f0c29;
    --bg2:#302b63;
    --accent1:#ff7ab6;
    --accent2:#3617d3;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(135deg,var(--bg1),var(--bg2));font-family:Inter, Poppins, system-ui;color:#fff}
  .wrap{max-width:900px;margin:20px auto;padding:16px;display:flex;flex-direction:column;align-items:center;gap:12px}
  h1{margin:0;font-size:clamp(20px,3.5vw,36px);text-align:center;letter-spacing:1px}
  .panel{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center}
  .stat{background:rgba(255,255,255,0.04);padding:10px 14px;border-radius:10px;backdrop-filter:blur(4px);min-width:120px;text-align:center}
  .stat b{display:block;font-size:18px;color:var(--accent2)}
  canvas{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02)}
  #uiControls{display:flex;gap:10px;align-items:center}
  .btn{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#111;padding:8px 12px;border-radius:10px;border:none;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(255,170,200,0.12)}
  .small{font-size:13px;padding:6px 10px}
  #controlsMobile{display:none;margin-top:6px;gap:8px}
  .arrow{width:56px;height:56px;border-radius:10px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-weight:800;cursor:pointer;user-select:none}
  .frustration{height:12px;width:220px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden}
  .frustration > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width 200ms linear}
  .footer{font-size:13px;color:rgba(255,255,255,0.7);text-align:center;margin-top:6px}
  @media(max-width:700px){
    .panel{flex-direction:column}
    #controlsMobile{display:flex}
  }
  /* confetti */
  .confetti{position:fixed;pointer-events:none;z-index:9999}
</style>
</head>
<body>
<div class="wrap">
  <h1>üî• Mini Snake ‚Äî Impossible Speed Mode</h1>
  <div class="panel">
    <div class="stat">Score<br><b id="score">0</b></div>
    <div class="stat">High<br><b id="high">0</b></div>
    <div class="stat">Speed (ms)<br><b id="speed">200</b></div>
    <div class="stat">Time<br><b id="timeSurv">0s</b></div>
    <div class="stat">Frustration<br><div class="frustration"><i id="frustr"></i></div></div>
    <div id="uiControls">
      <button class="btn small" id="startBtn">Start</button>
      <button class="btn small" id="resetBtn">Reset</button>
      <button class="btn small" id="muteBtn">Mute</button>
    </div>
  </div>

  <canvas id="board" width="600" height="600"></canvas>

  <div id="controlsMobile">
    <div style="display:flex;flex-direction:column;gap:8px">
      <div style="display:flex;gap:8px;justify-content:center">
        <div class="arrow" id="up">‚ñ≤</div>
      </div>
      <div style="display:flex;gap:8px;justify-content:center">
        <div class="arrow" id="left">‚óÄÔ∏è</div>
        <div class="arrow" id="down">‚ñº</div>
        <div class="arrow" id="right">‚ñ∂Ô∏è</div>
      </div>
    </div>
  </div>

  <div class="footer">Use Arrow keys or swipe. The snake gets faster <em>every second</em> ‚Äî try to survive!</div>
</div>

<!-- sounds -->
<audio id="eatSound" src="https://cdn.pixabay.com/download/audio/2021/09/15/audio_0621b1f5be.mp3?filename=short-click-112160.mp3"></audio>
<audio id="crashSound" src="https://cdn.pixabay.com/download/audio/2021/10/31/audio_9d3f3b85d0.mp3?filename=game-over-arcade-6435.mp3"></audio>
<audio id="bgLoop" loop src="https://cdn.pixabay.com/download/audio/2023/03/15/audio_9008e3b0f3.mp3?filename=soft-ambient-111827.mp3"></audio>

<script>
/* ======= CONFIG ======= */
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d');
const cellCount = 20;                    // grid size (cells per row/col)
let cellSize = Math.floor(canvas.width / cellCount);
let speedMs = 200;                       // initial tick interval (ms)
const minSpeed = 40;                     // minimal allowed interval (fastest)
const speedDecreasePerSec = 10;          // reduce interval by this many ms every second
let speedTimer;                          // interval ID for speed-up tracker
let gameTickTimer;                       // game loop interval ID
let timeSurvived = 0;                    // seconds survived
let timeTimer;                           // timer for survival seconds

/* ====== GAME STATE ====== */
let snake, dir, food, score, running, high;
let eatSound = document.getElementById('eatSound');
let crashSound = document.getElementById('crashSound');
let bgLoop = document.getElementById('bgLoop');
let muted = false;

/* mobile control elements */
const upBtn = document.getElementById('up');
const downBtn = document.getElementById('down');
const leftBtn = document.getElementById('left');
const rightBtn = document.getElementById('right');

function initGame(){
  cellSize = Math.floor(canvas.width / cellCount);
  snake = [{x:9,y:10},{x:8,y:10},{x:7,y:10}];
  dir = {x:1,y:0};
  spawnFood();
  score = 0;
  running = false;
  timeSurvived = 0;
  updateUI();
  draw();
}

/* spawn food not on snake */
function spawnFood(){
  while(true){
    const fx = Math.floor(Math.random()*cellCount);
    const fy = Math.floor(Math.random()*cellCount);
    if(!snake.some(s => s.x===fx && s.y===fy)){
      food = {x:fx,y:fy};
      break;
    }
  }
}

/* draw board */
function draw(){
  // background
  const g = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
  g.addColorStop(0,'rgba(255,123,168,0.06)');
  g.addColorStop(1,'rgba(255,209,102,0.06)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // grid subtle
  ctx.strokeStyle = 'rgba(255,255,255,0.03)';
  ctx.lineWidth = 1;
  for(let i=0;i<=cellCount;i++){
    ctx.beginPath();
    ctx.moveTo(i*cellSize,0);
    ctx.lineTo(i*cellSize,canvas.height);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(0,i*cellSize);
    ctx.lineTo(canvas.width,i*cellSize);
    ctx.stroke();
  }

  // food
  drawCell(food.x, food.y, '#ffdd57', true);

  // snake
  for(let i=0;i<snake.length;i++){
    const s=snake[i];
    // head glow
    if(i===0){
      drawCircleCell(s.x,s.y,'#ff7ab6', true);
    } else {
      drawCell(s.x,s.y, i%2 ? '#ffd166' : '#ff9ab2', false);
    }
  }
}

/* draw square cell with soft edges */
function drawCell(cx, cy, color, glow){
  const x = cx*cellSize + 2;
  const y = cy*cellSize + 2;
  const size = cellSize - 4;

  if(glow){
    ctx.save();
    ctx.shadowBlur = 18;
    ctx.shadowColor = color;
    ctx.fillStyle = color;
    roundRect(ctx, x, y, size, size, 8, true, false);
    ctx.restore();
  } else {
    ctx.fillStyle = color;
    roundRect(ctx, x, y, size, size, 6, true, false);
  }
}

/* draw circle style for head */
function drawCircleCell(cx, cy, color, glow){
  const x = cx*cellSize + cellSize/2;
  const y = cy*cellSize + cellSize/2;
  const r = cellSize*0.42;
  if(glow){
    ctx.save();
    ctx.shadowBlur = 22;
    ctx.shadowColor = color;
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  } else {
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
  }
}

/* rounded rectangle helper */
function roundRect(ctx,x,y,w,h,r,fill,stroke){
  if(fill==null) fill=true;
  if(stroke==null) stroke=false;
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

/* game tick */
function tick(){
  // move snake
  const head = {x:snake[0].x + dir.x, y:snake[0].y + dir.y};

  // wrap-around OFF; game over on wall collision
  if(head.x < 0 || head.x >= cellCount || head.y < 0 || head.y >= cellCount){
    gameOver();
    return;
  }

  // self collision
  if(snake.some(s => s.x===head.x && s.y===head.y)){
    gameOver();
    return;
  }

  snake.unshift(head);

  // eat food?
  if(head.x === food.x && head.y === food.y){
    score++;
    playSound(eatSound);
    spawnFood();
  } else {
    snake.pop();
  }

  draw();
  updateUI();
}

/* start / stop management */
function startGame(){
  if(running) return;
  running = true;
  // base speed restored if reset
  clearInterval(gameTickTimer);
  gameTickTimer = setInterval(tick, speedMs);
  // every second reduce interval (increase speed)
  clearInterval(speedTimer);
  speedTimer = setInterval(()=>{
    speedMs = Math.max(minSpeed, speedMs - speedDecreasePerSec);
    // restart tick with new speed
    clearInterval(gameTickTimer);
    gameTickTimer = setInterval(tick, speedMs);
    updateUI();
    // frustration meter update
    const fractEl = document.getElementById('frustr');
    const percent = Math.min(100, Math.round(((200 - speedMs) / 160) * 100));
    fractEl.style.width = percent + '%';
  },1000);

  // survival timer
  clearInterval(timeTimer);
  timeTimer = setInterval(()=>{
    timeSurvived++;
    document.getElementById('timeSurv').innerText = timeSurvived + 's';
  },1000);

  // play music
  if(!muted){ bgLoop.volume = 0.25; bgLoop.play().catch(()=>{}); }
}

/* game over */
function gameOver(){
  running = false;
  clearInterval(gameTickTimer);
  clearInterval(speedTimer);
  clearInterval(timeTimer);
  playSound(crashSound);
  // show explosion confetti
  explodeConfetti();
  // show final message
  document.getElementById('message').innerText = 'üí• Game Over! Final Score: ' + score + ' ‚Äî survived ' + timeSurvived + 's';
  // save highscore
  high = Math.max(high, score);
  localStorage.setItem('snakeHigh', high);
  updateUI();
}

/* reset */
function resetGame(){
  clearInterval(gameTickTimer);
  clearInterval(speedTimer);
  clearInterval(timeTimer);
  speedMs = 200;
  initGame();
  document.getElementById('message').innerText = '';
  // stop bg music
  bgLoop.pause();
  bgLoop.currentTime = 0;
}

/* keyboard & swipe input */
window.addEventListener('keydown', (e)=>{
  if(!running && ['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','w','a','s','d'].includes(e.key)) startGame();
  const key = e.key;
  if(key==='ArrowUp' || key==='w'){ if(dir.y!==1){ dir={x:0,y:-1}; } }
  if(key==='ArrowDown' || key==='s'){ if(dir.y!==-1){ dir={x:0,y:1}; } }
  if(key==='ArrowLeft' || key==='a'){ if(dir.x!==1){ dir={x:-1,y:0}; } }
  if(key==='ArrowRight' || key==='d'){ if(dir.x!==-1){ dir={x:1,y:0}; } }
});

/* mobile arrow controls */
upBtn.addEventListener('click', ()=>{ if(dir.y!==1) dir={x:0,y:-1}; startGame(); });
downBtn.addEventListener('click', ()=>{ if(dir.y!==-1) dir={x:0,y:1}; startGame(); });
leftBtn.addEventListener('click', ()=>{ if(dir.x!==1) dir={x:-1,y:0}; startGame(); });
rightBtn.addEventListener('click', ()=>{ if(dir.x!==-1) dir={x:1,y:0}; startGame(); });

/* swipe detection */
let touchStartX=0,touchStartY=0;
canvas.addEventListener('touchstart',(e)=>{
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
});
canvas.addEventListener('touchend',(e)=>{
  if(!e.changedTouches) return;
  const dx = e.changedTouches[0].clientX - touchStartX;
  const dy = e.changedTouches[0].clientY - touchStartY;
  if(Math.abs(dx) > Math.abs(dy)){
    if(dx > 30 && dir.x !== -1) dir={x:1,y:0};
    else if(dx < -30 && dir.x !== 1) dir={x:-1,y:0};
  } else {
    if(dy > 30 && dir.y !== -1) dir={x:0,y:1};
    else if(dy < -30 && dir.y !== 1) dir={x:0,y:-1};
  }
  startGame();
});

/* UI updates */
function updateUI(){
  document.getElementById('score').innerText = score;
  high = Number(localStorage.getItem('snakeHigh') || 0);
  document.getElementById('high').innerText = high;
  document.getElementById('speed').innerText = speedMs;
}

/* sounds safe play wrapper */
function playSound(audioEl){
  if(muted) return;
  try{ audioEl.currentTime = 0; audioEl.play(); }catch(e){}
}

/* confetti explosion */
function explodeConfetti(){
  for(let i=0;i<80;i++){
    const c = document.createElement('div');
    c.className='confetti';
    c.style.left = Math.random()*100+'%';
    c.style.top = '-10px';
    c.style.width = (6+Math.random()*10)+'px';
    c.style.height = c.style.width;
    c.style.background = `hsl(${Math.random()*360},90%,60%)`;
    document.body.appendChild(c);
    c.animate([
      { transform: `translateY(0) rotate(0deg)`, opacity:1 },
      { transform: `translateY(${window.innerHeight + 200}px) rotate(${360 + Math.random()*720}deg)`, opacity:0 }
    ], { duration: 1200 + Math.random()*1200, easing:'cubic-bezier(.2,.7,.2,1)' });
    setTimeout(()=>c.remove(), 2500);
  }
}

/* UI buttons */
document.getElementById('startBtn').addEventListener('click', ()=>{ startGame(); });
document.getElementById('resetBtn').addEventListener('click', ()=>{ resetGame(); });
document.getElementById('muteBtn').addEventListener('click', ()=>{
  muted = !muted;
  document.getElementById('muteBtn').innerText = muted ? 'Unmute' : 'Mute';
  if(muted) bgLoop.pause();
  else bgLoop.play();
});

/* initial setup */
high = Number(localStorage.getItem('snakeHigh') || 0);
initGame();
updateUI();

/* start animation draw loop (keeps canvas responsive visuals) */
(function animLoop(){ draw(); requestAnimationFrame(animLoop); })();
</script>
</body>
</html>